import e from"axios";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t,r,n,a,u,o){try{var i=e[u](o),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function n(e){return function(){var t=this,n=arguments;return new Promise(function(a,u){var o=e.apply(t,n);function i(e){r(o,a,u,i,c,"next",e)}function c(e){r(o,a,u,i,c,"throw",e)}i(void 0)})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){throw Error('"'+e+'" is read-only')}var i=function(e,t){var r="";return e?(e.forEach(function(e,n){var a=encodeURIComponent(e.key),u=t,i=a+"="+encodeURIComponent(e.value),c=RegExp("(&|\\?)"+a+"=[^&]*");o("s"),u=u.replace(c,"$1"+i),RegExp.$1||(u+=(o("s"),(0!=n?"&":"?")+i)),r=r.concat(u)}),r):t},c={url:null,api:null,token:null,version:.2},s=function(e){return new d(e)},p=function(e){return new f(e)},l=function(e,t){var r=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=r;var a=e.headers["content-disposition"],u=null;if(a){var o=a.match(/filename="?(.+)"?/);2===o.length&&(u=o[1])}if(!u&&t){var i=t.split("/"),c=i[i.length-1];i=c.split("\\"),u=c=i[i.length-1]}n.setAttribute("download",u=u||"unknown"),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(r)},d=function e(t){var r=this;a(this,e),u(this,"loaded",!1),u(this,"name",""),u(this,"version",""),u(this,"is_active",!1),u(this,"data_source",""),u(this,"predict",null),u(this,"accuracy",0),u(this,"status",""),u(this,"train_end_at",null),u(this,"updated_at",null),u(this,"created_at",null),u(this,"data_preparation",null),u(this,"data_analysis",null),u(this,"model_analysis",null),u(this,"columns",null),u(this,"load",function(){var e=n(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(t,"/predictors/".concat(r.name)),e.next=3,c.api.get(n);case 3:return Object.assign(r,e.sent.data),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"loadColumns",function(){var e=n(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(t,"/predictors/".concat(r.name,"/columns")),e.next=3,c.api.get(n);case 3:return r.columns=e.sent.data,e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"learn",function(){var e=n(regeneratorRuntime.mark(function e(t,n){var a,u,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.fromData,o={to_predict:t.toPredict},(a=t.dataSourceName)?o.data_source_name=a:u&&(o.from_data=u),s=i(n,"/predictors/".concat(r.name)),e.next=6,c.api.put(s,o);case 6:return e.abrupt("return",e.sent.data);case 8:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),u(this,"queryPredict",function(){var e=n(regeneratorRuntime.mark(function e(t,n){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i(n,"/predictors/".concat(r.name,"/predict")),e.next=3,c.api.post(a,{when:t});case 3:return e.abrupt("return",e.sent.data);case 5:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),u(this,"delete",function(){var e=n(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(t,"/predictors/".concat(r.name)),e.next=3,c.api.delete(n);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"upload",function(){var e=n(regeneratorRuntime.mark(function e(t,r,n){var a,u,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("file",t),u={onUploadProgress:function(e){r&&r(Math.round(100*e.loaded/e.total))}},o=i(n,"/predictors/upload"),e.next=6,c.api.post(o,a,u);case 6:case"end":return e.stop()}},e)}));return function(t,r,n){return e.apply(this,arguments)}}()),u(this,"download",function(){var e=n(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(t,"/predictors/".concat(r.name,"/download")),e.next=3,c.api.get(n,{responseType:"blob"});case 3:return l(e.sent),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"getDownloadUrl",function(){return"".concat(c.url,"/predictors/").concat(r.name,"/download")}),Object.assign(this,t)},f=function e(t){var r=this;a(this,e),u(this,"loaded",!1),u(this,"source_type","url"),u(this,"name",""),u(this,"source",""),u(this,"missed_files",!1),u(this,"created_at",null),u(this,"updated_at",null),u(this,"row_count",0),u(this,"columns",null),u(this,"data",null),u(this,"missedFileList",null),u(this,"load",function(){var e=n(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(t,"/datasources/".concat(r.name)),e.next=3,c.api.get(n);case 3:return Object.assign(r,e.sent.data),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"upload",function(){var e=n(regeneratorRuntime.mark(function e(t,n,a){var u,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.source_type="file",r.source=t.name,(u=new FormData).append("name",r.name),u.append("source_type",r.source_type),u.append("source",r.source),u.append("file",t),o={onUploadProgress:function(e){n&&n(Math.round(100*e.loaded/e.total))}},s=i(a,"/datasources/".concat(r.name)),e.next=11,c.api.put(s,u,o);case 11:case"end":return e.stop()}},e)}));return function(t,r,n){return e.apply(this,arguments)}}()),u(this,"uploadFromUrl",function(){var e=n(regeneratorRuntime.mark(function e(t,n){var a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.source_type="url",r.source=t,a={name:r.name,source_type:r.source_type,source:r.source},u=i(n,"/datasources/".concat(r.name)),e.next=6,c.api.put(u,a);case 6:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),u(this,"download",function(){var e=n(regeneratorRuntime.mark(function e(t){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getDownloadUrl(),a=i(t,n),e.next=4,c.api.get(a,{responseType:"blob"});case 4:return l(e.sent,r.source),e.abrupt("return",r);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"getDownloadUrl",function(){return"url"===r.source_type?r.source:"".concat(c.url,"/datasources/").concat(r.name,"/download")}),u(this,"delete",function(){var e=n(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(t,"/datasources/".concat(r.name)),e.next=3,c.api.delete(n);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"loadData",function(){var e=n(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i(t,"/datasources/".concat(r.name,"/data")),e.next=3,c.api.get("/datasources/".concat(r.name,"/data"));case 3:return r.data=e.sent.data,e.abrupt("return",r.data);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"loadDataQuality",function(){var e=n(regeneratorRuntime.mark(function e(t){var n,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(t,"/datasources/".concat(r.name,"/analyze")),e.next=3,c.api.get(n);case 3:a=e.sent;try{u=a.data.data_analysis.input_columns_metadata}catch(e){u=null}return r.dataQuality=u,e.abrupt("return",u);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"loadMissedFileList",function(){var e=n(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(t,"/datasources/".concat(r.name,"/missed_files")),e.next=3,c.api.get(n);case 3:return r.missedFileList=e.sent.data,e.abrupt("return",r.missedFileList);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"uploadFile",function(){var e=n(regeneratorRuntime.mark(function e(t,n){var a,u,o,s,p,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.column,u=t.rowIndex,o=t.extension,s=t.file,(p=new FormData).append("file",s),p.append("extension",o),l=i(n,"/datasources/".concat(r.name,"/files/").concat(a,":").concat(u)),e.next=7,c.api.put(l,p);case 7:return e.abrupt("return",200===e.sent.status);case 9:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),Object.assign(this,t)};export default{connect:function(t,r){c.url=i(r,t),c.api=e.create({baseURL:t,timeout:2e4})},disconnect:function(){c.url=null,c.token=null,c.api=null},ping:function(){var e=n(regeneratorRuntime.mark(function e(r){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(r,"/util/ping"),e.next=3,c.api.get(n);case 3:if(200!==(a=e.sent).status||"object"!==t(a.data)||"ok"!==a.data.status){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),predictors:function(){var e=n(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i(t,"/predictors"),e.next=3,c.api.get(r);case 3:return n=(e.sent.data||[]).map(s),e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),dataSources:function(){var e=n(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i(t,"/datasources"),e.next=3,c.api.get(r);case 3:return n=(e.sent.data||[]).map(p),e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),DataSource:p,Predictor:s};
