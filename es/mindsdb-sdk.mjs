import e from"axios";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,n,r,a,o,u){try{var i=e[o](u),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(a,o){var u=e.apply(t,r);function i(e){n(u,a,o,i,s,"next",e)}function s(e){n(u,a,o,i,s,"throw",e)}i(void 0)})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){throw Error('"'+e+'" is read-only')}var i=function(e,t){var n="";return e?(e.forEach(function(e,r){var a=encodeURIComponent(e.key),o=t,i=a+"="+encodeURIComponent(e.value),s=RegExp("(&|\\?)"+a+"=[^&]*");u("s"),o=o.replace(s,"$1"+i),RegExp.$1||(o+=(u("s"),(0!=r?"&":"?")+i)),n=n.concat(o)}),n):t},s={url:null,api:null,token:null,version:.2},c=function(e){return new l(e)},p=function(e){return new f(e)},d=function(e,t){var n=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=n;var a=e.headers["content-disposition"],o=null;if(a){var u=a.match(/filename="?(.+)"?/);2===u.length&&(o=u[1])}if(!o&&t){var i=t.split("/"),s=i[i.length-1];i=s.split("\\"),o=s=i[i.length-1]}r.setAttribute("download",o=o||"unknown"),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(n)},l=function e(t){var n=this;a(this,e),o(this,"loaded",!1),o(this,"name",""),o(this,"version",""),o(this,"is_active",!1),o(this,"data_source",""),o(this,"predict",null),o(this,"accuracy",0),o(this,"status",""),o(this,"train_end_at",null),o(this,"updated_at",null),o(this,"created_at",null),o(this,"data_preparation",null),o(this,"data_analysis",null),o(this,"model_analysis",null),o(this,"columns",null),o(this,"load",r(regeneratorRuntime.mark(function e(){var t,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(r.length>0&&void 0!==r[0]?r[0]:void 0,"/predictors/".concat(n.name)),e.next=4,s.api.get(t);case 4:return Object.assign(n,e.sent.data),e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}))),o(this,"loadColumns",r(regeneratorRuntime.mark(function e(){var t,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(r.length>0&&void 0!==r[0]?r[0]:void 0,"/predictors/".concat(n.name,"/columns")),e.next=4,s.api.get(t);case 4:return n.columns=e.sent.data,e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}))),o(this,"learn",function(){var e=r(regeneratorRuntime.mark(function e(t){var r,a,o,u,c,p=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.fromData,o=p.length>1&&void 0!==p[1]?p[1]:void 0,u={to_predict:t.toPredict},(r=t.dataSourceName)?u.data_source_name=r:a&&(u.from_data=a),c=i(o,"/predictors/".concat(n.name)),e.next=7,s.api.put(c,u);case 7:return e.abrupt("return",e.sent.data);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),o(this,"queryPredict",function(){var e=r(regeneratorRuntime.mark(function e(t){var r,a=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i(a.length>1&&void 0!==a[1]?a[1]:void 0,"/predictors/".concat(n.name,"/predict")),e.next=4,s.api.post(r,{when:t});case 4:return e.abrupt("return",e.sent.data);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),o(this,"delete",r(regeneratorRuntime.mark(function e(){var t,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(r.length>0&&void 0!==r[0]?r[0]:void 0,"/predictors/".concat(n.name)),e.next=4,s.api.delete(t);case 4:case"end":return e.stop()}},e)}))),o(this,"upload",function(){var e=r(regeneratorRuntime.mark(function e(t,n){var r,a,o,u,c=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:void 0,(a=new FormData).append("file",t),o={onUploadProgress:function(e){n&&n(Math.round(100*e.loaded/e.total))}},u=i(r,"/predictors/upload"),e.next=7,s.api.post(u,a,o);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),o(this,"download",r(regeneratorRuntime.mark(function e(){var t,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(r.length>0&&void 0!==r[0]?r[0]:void 0,"/predictors/".concat(n.name,"/download")),e.next=4,s.api.get(t,{responseType:"blob"});case 4:return d(e.sent),e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}))),o(this,"getDownloadUrl",function(){return"".concat(s.url,"/predictors/").concat(n.name,"/download")}),Object.assign(this,t)},f=function e(t){var n=this;a(this,e),o(this,"loaded",!1),o(this,"source_type","url"),o(this,"name",""),o(this,"source",""),o(this,"missed_files",!1),o(this,"created_at",null),o(this,"updated_at",null),o(this,"row_count",0),o(this,"columns",null),o(this,"data",null),o(this,"missedFileList",null),o(this,"load",r(regeneratorRuntime.mark(function e(){var t,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(r.length>0&&void 0!==r[0]?r[0]:void 0,"/datasources/".concat(n.name)),e.next=4,s.api.get(t);case 4:return Object.assign(n,e.sent.data),e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}))),o(this,"upload",function(){var e=r(regeneratorRuntime.mark(function e(t,r){var a,o,u,c,p=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.length>2&&void 0!==p[2]?p[2]:void 0,n.source_type="file",n.source=t.name,(o=new FormData).append("name",n.name),o.append("source_type",n.source_type),o.append("source",n.source),o.append("file",t),u={onUploadProgress:function(e){r&&r(Math.round(100*e.loaded/e.total))}},c=i(a,"/datasources/".concat(n.name)),e.next=12,s.api.put(c,o,u);case 12:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),o(this,"uploadFromUrl",function(){var e=r(regeneratorRuntime.mark(function e(t){var r,a,o,u=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:void 0,n.source_type="url",n.source=t,a={name:n.name,source_type:n.source_type,source:n.source},o=i(r,"/datasources/".concat(n.name)),e.next=7,s.api.put(o,a);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),o(this,"download",r(regeneratorRuntime.mark(function e(){var t,r,a,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:void 0,r=n.getDownloadUrl(),a=i(t,r),e.next=5,s.api.get(a,{responseType:"blob"});case 5:return d(e.sent,n.source),e.abrupt("return",n);case 8:case"end":return e.stop()}},e)}))),o(this,"getDownloadUrl",function(){return"url"===n.source_type?n.source:"".concat(s.url,"/datasources/").concat(n.name,"/download")}),o(this,"delete",r(regeneratorRuntime.mark(function e(){var t,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(r.length>0&&void 0!==r[0]?r[0]:void 0,"/datasources/".concat(n.name)),e.next=4,s.api.delete(t);case 4:case"end":return e.stop()}},e)}))),o(this,"loadData",r(regeneratorRuntime.mark(function e(){var t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i(t.length>0&&void 0!==t[0]?t[0]:void 0,"/datasources/".concat(n.name,"/data")),e.next=4,s.api.get("/datasources/".concat(n.name,"/data"));case 4:return n.data=e.sent.data,e.abrupt("return",n.data);case 7:case"end":return e.stop()}},e)}))),o(this,"loadDataQuality",r(regeneratorRuntime.mark(function e(){var t,r,a,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(o.length>0&&void 0!==o[0]?o[0]:void 0,"/datasources/".concat(n.name,"/analyze")),e.next=4,s.api.get(t);case 4:r=e.sent;try{a=r.data.data_analysis.input_columns_metadata}catch(e){a=null}return n.dataQuality=a,e.abrupt("return",a);case 8:case"end":return e.stop()}},e)}))),o(this,"loadMissedFileList",r(regeneratorRuntime.mark(function e(){var t,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(r.length>0&&void 0!==r[0]?r[0]:void 0,"/datasources/".concat(n.name,"/missed_files")),e.next=4,s.api.get(t);case 4:return n.missedFileList=e.sent.data,e.abrupt("return",n.missedFileList);case 7:case"end":return e.stop()}},e)}))),o(this,"uploadFile",function(){var e=r(regeneratorRuntime.mark(function e(t){var r,a,o,u,c,p,d,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.column,a=t.rowIndex,o=t.extension,u=t.file,c=l.length>1&&void 0!==l[1]?l[1]:void 0,(p=new FormData).append("file",u),p.append("extension",o),d=i(c,"/datasources/".concat(n.name,"/files/").concat(r,":").concat(a)),e.next=8,s.api.put(d,p);case 8:return e.abrupt("return",200===e.sent.status);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Object.assign(this,t)};export default{connect:function(t){s.url=t,s.api=e.create({baseURL:t,timeout:2e4})},disconnect:function(){s.url=null,s.token=null,s.api=null},ping:function(){var e=r(regeneratorRuntime.mark(function e(){var n,r,a=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i(a.length>0&&void 0!==a[0]?a[0]:void 0,"/util/ping"),e.next=4,s.api.get(n);case 4:if(200!==(r=e.sent).status||"object"!==t(r.data)||"ok"!==r.data.status){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),predictors:function(){var e=r(regeneratorRuntime.mark(function e(){var t,n,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(r.length>0&&void 0!==r[0]?r[0]:void 0,"/predictors"),e.next=4,s.api.get(t);case 4:return n=(e.sent.data||[]).map(c),e.abrupt("return",n);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),dataSources:function(){var e=r(regeneratorRuntime.mark(function e(){var t,n,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i(r.length>0&&void 0!==r[0]?r[0]:void 0,"/datasources"),e.next=4,s.api.get(t);case 4:return n=(e.sent.data||[]).map(p),e.abrupt("return",n);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),DataSource:p,Predictor:c};
