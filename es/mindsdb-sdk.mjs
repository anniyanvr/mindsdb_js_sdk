import e from"axios";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,n,r,a,u,o){try{var i=e[u](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(a,u){var o=e.apply(t,r);function i(e){n(o,a,u,i,c,"next",e)}function c(e){n(o,a,u,i,c,"throw",e)}i(void 0)})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(e,t){var n="";return e?(e.forEach(function(e,t){e.value&&(n=n.concat(encodeURIComponent(e.key)+"="+encodeURIComponent(e.value)))}),"/"===t.slice(-1)&&(t=t.substring(0,t.length-1)),t+"".concat(i>0?"&":"?")+n):t},c={url:null,api:null,token:null,version:.2},s=function(e){return new d(e)},p=function(e){return new f(e)},l=function(e,t){var n=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=n;var a=e.headers["content-disposition"],u=null;if(a){var o=a.match(/filename="?(.+)"?/);2===o.length&&(u=o[1])}if(!u&&t){var i=t.split("/"),c=i[i.length-1];i=c.split("\\"),u=c=i[i.length-1]}r.setAttribute("download",u=u||"unknown"),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(n)},d=function e(t){var n=this;a(this,e),u(this,"loaded",!1),u(this,"name",""),u(this,"version",""),u(this,"is_active",!1),u(this,"data_source",""),u(this,"predict",null),u(this,"accuracy",0),u(this,"status",""),u(this,"train_end_at",null),u(this,"updated_at",null),u(this,"created_at",null),u(this,"data_preparation",null),u(this,"data_analysis",null),u(this,"model_analysis",null),u(this,"columns",null),u(this,"load",function(){var e=r(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(t,"/predictors/".concat(n.name)),e.next=3,c.api.get(r);case 3:return Object.assign(n,e.sent.data),e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"loadColumns",function(){var e=r(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(t,"/predictors/".concat(n.name,"/columns")),e.next=3,c.api.get(r);case 3:return n.columns=e.sent.data,e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"learn",function(){var e=r(regeneratorRuntime.mark(function e(t,r){var a,u,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.fromData,i={to_predict:t.toPredict},(a=t.dataSourceName)?i.data_source_name=a:u&&(i.from_data=u),s=o(r,"/predictors/".concat(n.name)),e.next=6,c.api.put(s,i);case 6:return e.abrupt("return",e.sent.data);case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),u(this,"queryPredict",function(){var e=r(regeneratorRuntime.mark(function e(t,r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o(r,"/predictors/".concat(n.name,"/predict")),e.next=3,c.api.post(a,{when:t});case 3:return e.abrupt("return",e.sent.data);case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),u(this,"delete",function(){var e=r(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(t,"/predictors/".concat(n.name)),e.next=3,c.api.delete(r);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"upload",function(){var e=r(regeneratorRuntime.mark(function e(t,n,r){var a,u,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("file",t),u={onUploadProgress:function(e){n&&n(Math.round(100*e.loaded/e.total))}},i=o(r,"/predictors/upload"),e.next=6,c.api.post(i,a,u);case 6:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),u(this,"download",function(){var e=r(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(t,"/predictors/".concat(n.name,"/download")),e.next=3,c.api.get(r,{responseType:"blob"});case 3:return l(e.sent),e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"getDownloadUrl",function(){return"".concat(c.url,"/predictors/").concat(n.name,"/download")}),Object.assign(this,t)},f=function e(t){var n=this;a(this,e),u(this,"loaded",!1),u(this,"source_type","url"),u(this,"name",""),u(this,"source",""),u(this,"missed_files",!1),u(this,"created_at",null),u(this,"updated_at",null),u(this,"row_count",0),u(this,"columns",null),u(this,"data",null),u(this,"missedFileList",null),u(this,"load",function(){var e=r(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(t,"/datasources/".concat(n.name)),e.next=3,c.api.get(r);case 3:return Object.assign(n,e.sent.data),e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"upload",function(){var e=r(regeneratorRuntime.mark(function e(t,r,a){var u,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.source_type="file",n.source=t.name,(u=new FormData).append("name",n.name),u.append("source_type",n.source_type),u.append("source",n.source),u.append("file",t),i={onUploadProgress:function(e){r&&r(Math.round(100*e.loaded/e.total))}},s=o(a,"/datasources/".concat(n.name)),e.next=11,c.api.put(s,u,i);case 11:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),u(this,"uploadFromUrl",function(){var e=r(regeneratorRuntime.mark(function e(t,r){var a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.source_type="url",n.source=t,a={name:n.name,source_type:n.source_type,source:n.source},u=o(r,"/datasources/".concat(n.name)),e.next=6,c.api.put(u,a);case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),u(this,"download",function(){var e=r(regeneratorRuntime.mark(function e(t){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getDownloadUrl(),a=o(t,r),e.next=4,c.api.get(a,{responseType:"blob"});case 4:return l(e.sent,n.source),e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"getDownloadUrl",function(){return"url"===n.source_type?n.source:"".concat(c.url,"/datasources/").concat(n.name,"/download")}),u(this,"delete",function(){var e=r(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(t,"/datasources/".concat(n.name)),e.next=3,c.api.delete(r);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"loadData",function(){var e=r(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(t,"/datasources/".concat(n.name,"/data")),e.next=3,c.api.get(r);case 3:return n.data=e.sent.data,e.abrupt("return",n.data);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"loadDataQuality",function(){var e=r(regeneratorRuntime.mark(function e(t){var r,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(t,"/datasources/".concat(n.name,"/analyze")),e.next=3,c.api.get(r);case 3:a=e.sent;try{u=a.data.data_analysis.input_columns_metadata}catch(e){u=null}return n.dataQuality=u,e.abrupt("return",u);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"loadMissedFileList",function(){var e=r(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(t,"/datasources/".concat(n.name,"/missed_files")),e.next=3,c.api.get(r);case 3:return n.missedFileList=e.sent.data,e.abrupt("return",n.missedFileList);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"uploadFile",function(){var e=r(regeneratorRuntime.mark(function e(t,r){var a,u,i,s,p,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.column,u=t.rowIndex,i=t.extension,s=t.file,(p=new FormData).append("file",s),p.append("extension",i),l=o(r,"/datasources/".concat(n.name,"/files/").concat(a,":").concat(u)),e.next=7,c.api.put(l,p);case 7:return e.abrupt("return",200===e.sent.status);case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),Object.assign(this,t)};export default{connect:function(t,n){c.token=n.find(function(e){return"apiKey"===e.key}).value,c.url=o(n,t),c.api=e.create({baseURL:t,timeout:2e4})},disconnect:function(){c.url=null,c.token=null,c.api=null},ping:function(){var e=r(regeneratorRuntime.mark(function e(n){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o(n,"/util/ping"),e.next=3,c.api.get(r);case 3:if(200!==(a=e.sent).status||"object"!==t(a.data)||"ok"!==a.data.status){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),predictors:function(){var e=r(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o(t,"/predictors"),e.next=3,c.api.get(n);case 3:return r=(e.sent.data||[]).map(s),e.abrupt("return",r);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),dataSources:function(){var e=r(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o(t,"/datasources"),e.next=3,c.api.get(n);case 3:return r=(e.sent.data||[]).map(p),e.abrupt("return",r);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),DataSource:p,Predictor:s};
